<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no">
<style>
#canvas1{border:1px solid black;margin:0px 0px;}
</style>
<script>
function game(){
	this.documentWidth=window.screen.availWidth;
	this.documentHeight=window.screen.availHeight;
	this.canvas1=document.getElementById("canvas1");
	this.canvas1.width=this.documentWidth;
	this.canvas1.height=this.documentHeight;
	this.ctx=this.canvas1.getContext("2d");
	this.black=new Image();
	this.black.src="./image/black.png";
	this.white=new Image();
	this.white.src="./image/white.png";
	this.startblack=new Image();
	this.startblack.src="./image/startblack.png";
	this.startyellow=new Image();
	this.startyellow.src="./image/startyellow.png";
	//玩家的操作序列
	this.wanjia=new Array();
	//生成的块序列
	this.block=new Array();
	//目前玩到第几层了
	this.num=0;
	
	this.counter=0;
	//保存最后一排块
	this.temp=0;
	//是否在动画状态
	this.isanimation=false;
	
}

game.prototype.draw=function(height,obj1,obj2,obj3,obj4){
	//画一排块
	
	this.ctx.drawImage(obj1,0,height,this.documentWidth/4,this.documentHeight/4);
	this.ctx.drawImage(obj2,this.documentWidth/4,height,this.documentWidth/4,this.documentHeight/4);
	this.ctx.drawImage(obj3,2*this.documentWidth/4,height,this.documentWidth/4,this.documentHeight/4);
	this.ctx.drawImage(obj4,3*this.documentWidth/4,height,this.documentWidth/4,this.documentHeight/4);
}

game.prototype.touch=function(ev){
	//判断触摸到哪个块
	if(ev.touches[0].pageY>=2*this.documentHeight/4&&ev.touches[0].pageY<=3*this.documentHeight/4){
		if(ev.touches[0].pageX>=0&&ev.touches[0].pageX<=this.documentWidth/4)this.wanjia.push(1);
		else if(ev.touches[0].pageX>=this.documentWidth/4&&ev.touches[0].pageX<=2*this.documentWidth/4)this.wanjia.push(2);
		else if(ev.touches[0].pageX>=2*this.documentWidth/4&&ev.touches[0].pageX<=3*this.documentWidth/4)this.wanjia.push(3);
		else this.wanjia.push(4);
	}
}
game.prototype.animation=function(c){
	//动画
	for(var i=0;i<4;i++){
		switch(this.block[i]){
		case 1:
		this.draw((2-i)*this.documentHeight/4+c,this.black,this.white,this.white,this.white);
		break;
		case 2:
		
		this.draw((2-i)*this.documentHeight/4+c,this.white,this.black,this.white,this.white);
		break;
		case 3:
		
		this.draw((2-i)*this.documentHeight/4+c,this.white,this.white,this.black,this.white);
		break;
		case 4:
		this.draw((2-i)*this.documentHeight/4+c,this.white,this.white,this.white,this.black);
		
		break;
		}
	}
		switch(this.temp){
		case 1:
		this.draw(3*this.documentHeight/4+c,this.black,this.white,this.white,this.white);
		break;
		case 2:
		
		this.draw(3*this.documentHeight/4+c,this.white,this.black,this.white,this.white);
		break;
		case 3:
		
		this.draw(3*this.documentHeight/4+c,this.white,this.white,this.black,this.white);
		break;
		case 4:
		this.draw(3*this.documentHeight/4+c,this.white,this.white,this.white,this.black);
		
		break;
		}
	
}


game.prototype.zhen=function(GAME){
	//游戏主循环
	if(this.isanimation){
		if(this.counter==5){this.counter=0;this.temp=this.block.shift();this.isanimation=false;}
		else{
		this.counter++;
		this.animation(this.documentHeight/4/5*this.counter);
		}
	
	}
	
	
	if(!this.isanimation){
			//如果不是在动画状态，执行逻辑
			this.animation(0);
			if(this.block.length<20){
				//增加白块
				for(var i=this.block.length;i<20;i++){
					var k;
					var lyq=Math.random();
					if(lyq<1/4)k=1;
					else if(lyq<1/2)k=2;
					else if(lyq<3/4)k=3;
					else k=4;
					this.block.push(k);
				}
			}
		if(this.wanjia.length){
			var haha=this.wanjia.shift();
			if(haha==this.block[0]){
				//成功触碰到黑块，开启动画状态
				//this.temp=this.block.shift();
				this.counter=0;
				this.isanimation=true;
				
			}
			else{
				//触碰到白块,游戏结束
				return;
			}
			
		} 
	}
	window.webkitRequestAnimationFrame(function(){GAME.zhen(GAME)});
}


window.onload=function(){
	var GAME=new game();
	GAME.canvas1.addEventListener('touchstart',function(ev){GAME.touch(ev);});
				for(var i=GAME.block.length;i<20;i++){
					var k;
					var lyq=Math.random();
					if(lyq<1/4)k=1;
					else if(lyq<1/2)k=2;
					else if(lyq<3/4)k=3;
					else k=4;
					GAME.block.push(k);
				}
	counter=0;
	window.webkitRequestAnimationFrame(function(){GAME.zhen(GAME)});
	

}
</script>
</head>
<body>
<canvas id="canvas1"></canvas>
</body>
</html>